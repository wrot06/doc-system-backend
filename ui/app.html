<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>App</title>
</head>
<body>
<h2>Cargando sesión…</h2>

<script>
const token=localStorage.getItem('token')
if(!token)location.href='login.html'

fetch('/me',{headers:{Authorization:'Bearer '+token}})
.then(r=>{
  if(!r.ok)throw 0
  return r.json()
})
.then(u=>{
  document.body.innerHTML=
    `<h2>Bienvenido</h2>
     <p>Rol: ${u.rol}</p>
     <p>Dependencia ID: ${u.dependencia_id}</p>
     <button onclick="logout()">Cerrar sesión</button>`
})
.catch(()=>{
  localStorage.removeItem('token')
  location.href='login.html'
})

function logout(){
  localStorage.removeItem('token')
  location.href='login.html'
}
</script>
</body>
</html>
